<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>Flask PM2.5 æ•™å­¸æ‰‹å†Š</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", "Noto Sans TC", sans-serif;
            line-height: 1.8;
            max-width: 960px;
            margin: auto;
            padding: 2rem;
            background-color: #f9f9f9;
        }
        h1, h2, h3 {
            color: #005b96;
        }
        code {
            background: #eee;
            padding: 2px 4px;
            border-radius: 3px;
        }
        pre {
            background: #eee;
            padding: 1em;
            overflow-x: auto;
        }
        a {
            color: #007acc;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        hr {
            border: none;
            border-top: 1px solid #ccc;
            margin: 2em 0;
        }
    </style>
</head>
<body>
<h1>Flask PM2.5 ç©ºæ°£å“è³ªç›£æ¸¬ç³»çµ±</h1>

<h3>å®Œæ•´æ•™å­¸æ‰‹å†Š</h3>

<p>ä½œè€…ï¼šJerryï¼ˆGPT æ•™å­¸æ•´ç†ï¼‰<br />
ç‰ˆæœ¬ï¼šv1.0<br />
æ—¥æœŸï¼š2025 å¹´  </p>

<hr />

<h2>ğŸ“– ç›®éŒ„</h2>

<ol>
<li><a href="#ç¬¬ä¸€ç« ç’°å¢ƒèˆ‡å°ˆæ¡ˆåˆå§‹åŒ–">ç¬¬ä¸€ç« ï¼šç’°å¢ƒèˆ‡å°ˆæ¡ˆåˆå§‹åŒ–</a></li>
<li><a href="#ç¬¬äºŒç« å»ºç«‹è³‡æ–™åº«">ç¬¬äºŒç« ï¼šå»ºç«‹è³‡æ–™åº«</a></li>
<li><a href="#ç¬¬ä¸‰ç« å–å¾—-pm25-é–‹æ”¾è³‡æ–™ä¸¦å¯«å…¥è³‡æ–™åº«">ç¬¬ä¸‰ç« ï¼šå–å¾— PM2.5 é–‹æ”¾è³‡æ–™ä¸¦å¯«å…¥è³‡æ–™åº«</a></li>
<li><a href="#ç¬¬å››ç« å»ºç«‹å‰ç«¯ç¶²ç«™èˆ‡åœ–è¡¨å±•ç¤º">ç¬¬å››ç« ï¼šå»ºç«‹å‰ç«¯ç¶²ç«™èˆ‡åœ–è¡¨å±•ç¤º</a></li>
<li><a href="#ç¬¬äº”ç« è‡ªå‹•æ’ç¨‹èˆ‡-github-actions-è‡ªå‹•æ›´æ–°">ç¬¬äº”ç« ï¼šè‡ªå‹•æ’ç¨‹èˆ‡ GitHub Actions è‡ªå‹•æ›´æ–°</a></li>
<li><a href="#ç¬¬å…­ç« éƒ¨ç½²-flask-pm25-å°ˆæ¡ˆåˆ°ç·šä¸Š">ç¬¬å…­ç« ï¼šéƒ¨ç½² Flask PM2.5 å°ˆæ¡ˆåˆ°ç·šä¸Š</a></li>
<li><a href="#ç¬¬ä¸ƒç« åŠŸèƒ½æ“´å……èˆ‡é€²éšæ‡‰ç”¨">ç¬¬ä¸ƒç« ï¼šåŠŸèƒ½æ“´å……èˆ‡é€²éšæ‡‰ç”¨</a></li>
</ol>

<hr />

<h1>Flask PM2.5 ç©ºæ°£å“è³ªç›£æ¸¬ç³»çµ± - å®Œæ•´æ•™å­¸æ‰‹å†Š</h1>

<p>ä½œè€…ï¼šJerryï¼ˆGPT æ•™å­¸æ•´ç†ï¼‰</p>

<hr />

<h1>ç¬¬ä¸€ç« ï¼šç’°å¢ƒèˆ‡å°ˆæ¡ˆåˆå§‹åŒ–</h1>

<p>æœ¬ç« ç¯€å°‡å”åŠ©ä½ å»ºç«‹ä¸€å€‹ä¹¾æ·¨çš„ Flask å°ˆæ¡ˆç’°å¢ƒï¼Œæº–å‚™å¥½æ—¥å¾Œé–‹ç™¼ PM2.5 è³‡æ–™ç›£æ§ç¶²ç«™ã€‚</p>

<hr />

<h2>ğŸ¯ æ•™å­¸ç›®æ¨™</h2>

<ul>
<li>å®‰è£ Python èˆ‡è™›æ“¬ç’°å¢ƒ</li>
<li>åˆå§‹åŒ– Flask å°ˆæ¡ˆçµæ§‹</li>
<li>å®‰è£å¿…è¦å¥—ä»¶</li>
<li>å»ºç«‹ Git å°ˆæ¡ˆä¸¦å¿½ç•¥ä¸å¿…è¦çš„æª”æ¡ˆ</li>
</ul>

<hr />

<h2>1ï¸âƒ£ å®‰è£ Python èˆ‡å»ºç«‹è™›æ“¬ç’°å¢ƒ</h2>

<p>è«‹ç¢ºèªä½ å·²å®‰è£å¥½ Python 3.8 æˆ–ä»¥ä¸Šç‰ˆæœ¬ã€‚å¯ç”¨ä»¥ä¸‹æŒ‡ä»¤æª¢æŸ¥ç‰ˆæœ¬ï¼š</p>

<p><code>bash
python --version
</code></p>

<p>æ¥è‘—å»ºç«‹ä¸€å€‹æ–°çš„è™›æ“¬ç’°å¢ƒ <code>pm25-env</code>ï¼š</p>

<p><code>bash
python -m venv pm25-env
</code></p>

<p>å•Ÿå‹•è™›æ“¬ç’°å¢ƒï¼š</p>

<ul>
<li><p><strong>Windows</strong>ï¼š</p>

<p><code>bash
pm25-env\Scripts\activate
</code></p></li>
<li><p><strong>macOS / Linux</strong>ï¼š</p>

<p><code>bash
source pm25-env/bin/activate
</code></p></li>
</ul>

<hr />

<h2>2ï¸âƒ£ å®‰è£ Flask èˆ‡ç›¸é—œå¥—ä»¶</h2>

<p>åœ¨è™›æ“¬ç’°å¢ƒä¸­å®‰è£ Flask ä»¥åŠå…¶ä»–æ‰€éœ€å¥—ä»¶ï¼š</p>

<p><code>bash
pip install flask requests pymysql
</code></p>

<p>ğŸ“Œ <strong>è£œå……èªªæ˜ï¼š</strong></p>

<p>| å¥—ä»¶åç¨± | ç”¨é€” |
|----------|------|
| <code>flask</code> | å»ºç«‹ Web API èˆ‡å‰ç«¯ç¶²ç«™ |
| <code>requests</code> | æŠ“å–æ”¿åºœé–‹æ”¾ PM2.5 è³‡æ–™ |
| <code>pymysql</code> | Python é€£æ¥ MySQL è³‡æ–™åº« |</p>

<p>ç‚ºäº†å°‡ç›®å‰å®‰è£çš„å¥—ä»¶è¨˜éŒ„ä¸‹ä¾†ï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š</p>

<p><code>bash
pip freeze &gt; requirements.txt
</code></p>

<hr />

<h2>3ï¸âƒ£ å»ºç«‹å°ˆæ¡ˆçµæ§‹</h2>

<p>è«‹åœ¨ä½ çš„å°ˆæ¡ˆè³‡æ–™å¤¾å…§å»ºç«‹ä»¥ä¸‹çµæ§‹ï¼š</p>

<p><code>
pm25-flask/
â”œâ”€â”€ app.py              # ä¸»ç¨‹å¼
â”œâ”€â”€ requirements.txt    # å¥—ä»¶æ¸…å–®
â”œâ”€â”€ templates/          # HTML æ¨¡æ¿
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ static/             # éœæ…‹è³‡æºï¼ˆCSS/JSï¼‰
â””â”€â”€ pm25_utils.py       # è³‡æ–™è™•ç†å·¥å…·
</code></p>

<p>ğŸ“Œ <strong>çµæ§‹èªªæ˜ï¼š</strong></p>

<p>| æª”æ¡ˆ/è³‡æ–™å¤¾       | åŠŸèƒ½èªªæ˜ |
|------------------|----------|
| <code>app.py</code>         | ä¸» Flask ç¨‹å¼å…¥å£ |
| <code>templates/</code>     | å­˜æ”¾ HTML æ¨¡æ¿ |
| <code>static/</code>        | å­˜æ”¾éœæ…‹è³‡æºï¼ˆCSS/JS åœ–ç‰‡ç­‰ï¼‰ |
| <code>pm25_utils.py</code>  | æ”¾ API æŠ“å–èˆ‡è³‡æ–™è½‰æ›é‚è¼¯ |
| <code>requirements.txt</code> | å¥—ä»¶æ¸…å–®ï¼ˆå¯ç”¨æ–¼éƒ¨ç½²ï¼‰ |</p>

<hr />

<h2>4ï¸âƒ£ åˆå§‹åŒ– Git å°ˆæ¡ˆ</h2>

<p>è‹¥ä½ æ‰“ç®—ä½¿ç”¨ Git ç‰ˆæœ¬æ§åˆ¶ï¼Œåœ¨è³‡æ–™å¤¾ä¸­åŸ·è¡Œï¼š</p>

<p><code>bash
git init
</code></p>

<p>æ¥è‘—å»ºç«‹ <code>.gitignore</code> æª”æ¡ˆï¼ŒåŠ å…¥ä»¥ä¸‹å…§å®¹ï¼š</p>

<p><code>gitignore
__pycache__/
pm25-env/
*.pyc
.env
</code></p>

<hr />

<h2>5ï¸âƒ£ æ¸¬è©¦ Flask æ˜¯å¦èƒ½æ­£å¸¸å•Ÿå‹•</h2>

<p>è«‹å…ˆå»ºç«‹ <code>app.py</code>ï¼Œä¸¦å¯«å…¥ä»¥ä¸‹å…§å®¹ï¼š</p>

<p>```python
from flask import Flask</p>

<p>app = Flask(<strong>name</strong>)</p>

<p>@app.route('/')
def index():
    return "Flask PM2.5 å°ˆæ¡ˆåˆå§‹åŒ–æˆåŠŸï¼"</p>

<p>if <strong>name</strong> == '<strong>main</strong>':
    app.run(debug=True)
```</p>

<p>åŸ·è¡Œä¼ºæœå™¨ï¼š</p>

<p><code>bash
python app.py
</code></p>

<p>æ‰“é–‹ç€è¦½å™¨ï¼Œå‰å¾€ <code>http://127.0.0.1:5000/</code><br />
âœ… è‹¥é¡¯ç¤ºã€ŒFlask PM2.5 å°ˆæ¡ˆåˆå§‹åŒ–æˆåŠŸï¼ã€å³ä»£è¡¨æˆåŠŸï¼</p>

<hr />

<h2>ğŸ“Œ å°æé†’</h2>

<ul>
<li><p>é›¢é–‹è™›æ“¬ç’°å¢ƒå¯è¼¸å…¥ï¼š</p>

<p><code>bash
deactivate
</code></p></li>
</ul>

<hr />

<h2>âœ… æœ¬ç« çµæŸ</h2>

<p>ä½ å·²å®Œæˆå°ˆæ¡ˆåˆå§‹åŒ–èˆ‡ç’°å¢ƒè¨­å®šï¼Œä¸‹ä¸€ç« æˆ‘å€‘å°‡å»ºç«‹ <strong>MySQL è³‡æ–™åº«</strong>ï¼Œæº–å‚™å„²å­˜ PM2.5 è³‡æ–™ã€‚</p>

<hr />

<h1>ç¬¬äºŒç« ï¼šå»ºç«‹è³‡æ–™åº«</h1>

<p>æœ¬ç« ç¯€å°‡å”åŠ©ä½ å»ºç«‹ MySQL è³‡æ–™åº«ï¼Œè¨­è¨ˆ PM2.5 è³‡æ–™è¡¨ï¼Œä¸¦é€é Python æˆåŠŸé€£æ¥è³‡æ–™åº«ï¼Œç‚ºå¾ŒçºŒå„²å­˜è³‡æ–™åšæº–å‚™ã€‚</p>

<hr />

<h2>ğŸ¯ æ•™å­¸ç›®æ¨™</h2>

<ul>
<li>å»ºç«‹ MySQL è³‡æ–™åº«èˆ‡è¡¨æ ¼</li>
<li>è¨­è¨ˆè³‡æ–™æ¬„ä½çµæ§‹</li>
<li>æ’°å¯« Python è³‡æ–™åº«é€£ç·šèˆ‡æ¸¬è©¦ç¨‹å¼</li>
</ul>

<hr />

<h2>1ï¸âƒ£ å»ºç«‹ MySQL è³‡æ–™åº«èˆ‡å¸³è™Ÿ</h2>

<p>è«‹å…ˆç¢ºèªä½ å·²å®‰è£ MySQL Serverï¼Œä¸¦èƒ½ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤é€²å…¥å‘½ä»¤åˆ—ï¼š</p>

<p><code>bash
mysql -u root -p
</code></p>

<p>ç™»å…¥å¾Œï¼Œå»ºç«‹ä¸€å€‹è³‡æ–™åº«ï¼š</p>

<p><code>sql
CREATE DATABASE pm25_db DEFAULT CHARSET utf8mb4 COLLATE utf8mb4_unicode_ci;
</code></p>

<p>ä½ ä¹Ÿå¯ä»¥å¦å¤–å»ºç«‹å°ˆç”¨å¸³è™Ÿï¼ˆé¸æ“‡æ€§ï¼‰ï¼š</p>

<p><code>sql
CREATE USER 'pm25user'@'localhost' IDENTIFIED BY 'pm25pass';
GRANT ALL PRIVILEGES ON pm25_db.* TO 'pm25user'@'localhost';
FLUSH PRIVILEGES;
</code></p>

<hr />

<h2>2ï¸âƒ£ å»ºç«‹è³‡æ–™è¡¨çµæ§‹</h2>

<p>é¸æ“‡å‰›å‰›å»ºç«‹çš„è³‡æ–™åº«ï¼Œä¸¦å»ºç«‹è³‡æ–™è¡¨ï¼š</p>

<p>```sql
USE pm25_db;</p>

<p>CREATE TABLE pm25<em>data (
    id INT AUTO</em>INCREMENT PRIMARY KEY,
    county VARCHAR(20),
    site VARCHAR(30),
    pm25 FLOAT,
    datacreationdate DATETIME,
    unit VARCHAR(10),
    UNIQUE KEY uq<em>site</em>time (site, datacreationdate)
);
```</p>

<p>ğŸ“Œ è£œå……èªªæ˜ï¼š</p>

<p>| æ¬„ä½åç¨±         | èªªæ˜           |
|------------------|----------------|
| <code>county</code>         | ç¸£å¸‚           |
| <code>site</code>           | æ¸¬ç«™åç¨±       |
| <code>pm25</code>           | PM2.5 æ•¸å€¼     |
| <code>datacreationdate</code> | è³‡æ–™æ™‚é–“     |
| <code>unit</code>           | å–®ä½ï¼ˆå¦‚ Âµg/mÂ³ï¼‰|</p>

<hr />

<h2>3ï¸âƒ£ å®‰è£ä¸¦æ’°å¯« Python è³‡æ–™åº«é€£ç·šç¨‹å¼</h2>

<p>æˆ‘å€‘ä½¿ç”¨ <code>pymysql</code> å¥—ä»¶ä¾†æ“ä½œè³‡æ–™åº«ã€‚è«‹å…ˆç¢ºèªå·²å®‰è£ï¼š</p>

<p><code>bash
pip install pymysql
</code></p>

<p>å»ºç«‹ä¸€å€‹ <code>db_utils.py</code> æª”æ¡ˆï¼ŒåŠ å…¥ä»¥ä¸‹é€£ç·šå‡½å¼ï¼š</p>

<p>```python
import pymysql</p>

<p>def open<em>db():
    return pymysql.connect(
        host="localhost",
        user="pm25user",       # æˆ– root
        password="pm25pass",   # æˆ– root å¯†ç¢¼
        database="pm25</em>db",
        charset="utf8mb4"
    )
```</p>

<hr />

<h2>4ï¸âƒ£ æ¸¬è©¦é€£ç·šæ˜¯å¦æˆåŠŸ</h2>

<p>æ–°å¢ <code>test_db.py</code> æª”æ¡ˆï¼Œå¯«å…¥ä»¥ä¸‹å…§å®¹ï¼š</p>

<p>```python
from db<em>utils import open</em>db</p>

<p>try:
    conn = open_db()
    print("âœ… è³‡æ–™åº«é€£ç·šæˆåŠŸ")
except Exception as e:
    print("âŒ é€£ç·šå¤±æ•—:", e)
finally:
    if 'conn' in locals():
        conn.close()
```</p>

<p>åŸ·è¡Œæ¸¬è©¦ï¼š</p>

<p><code>bash
python test_db.py
</code></p>

<p>è‹¥é¡¯ç¤º <code>âœ… è³‡æ–™åº«é€£ç·šæˆåŠŸ</code> å³è¡¨ç¤ºå®Œæˆæœ¬ç« æ“ä½œ ğŸ‰</p>

<hr />

<h2>âœ… æœ¬ç« çµæŸ</h2>

<p>ä½ å·²æˆåŠŸå»ºç«‹ PM2.5 è³‡æ–™è¡¨ï¼Œä¸¦èƒ½é€é Python é€£æ¥è³‡æ–™åº«ã€‚<br />
ä¸‹ä¸€ç« æˆ‘å€‘å°‡å¾æ”¿åºœé–‹æ”¾è³‡æ–™ API æŠ“å–å³æ™‚ PM2.5 è³‡æ–™ä¸¦å¯«å…¥è³‡æ–™åº«ã€‚</p>

<hr />

<h1>ç¬¬ä¸‰ç« ï¼šå–å¾— PM2.5 é–‹æ”¾è³‡æ–™ä¸¦å¯«å…¥è³‡æ–™åº«</h1>

<p>æœ¬ç« ç¯€å°‡æŒ‡å°ä½ å¦‚ä½•é€éæ”¿åºœæä¾›çš„ PM2.5 é–‹æ”¾è³‡æ–™ APIï¼ŒæŠ“å–å³æ™‚è³‡æ–™ä¸¦å¯«å…¥ MySQL è³‡æ–™åº«ã€‚</p>

<hr />

<h2>ğŸ¯ æ•™å­¸ç›®æ¨™</h2>

<ul>
<li>äº†è§£ PM2.5 é–‹æ”¾è³‡æ–™ API</li>
<li>æ’°å¯«è³‡æ–™æŠ“å–èˆ‡è½‰æ›ç¨‹å¼</li>
<li>å°‡è³‡æ–™å¯«å…¥è³‡æ–™åº«ï¼Œé¿å…é‡è¤‡å¯«å…¥</li>
</ul>

<hr />

<h2>1ï¸âƒ£ è³‡æ–™ä¾†æºä»‹ç´¹</h2>

<p>è³‡æ–™ä¾†æºï¼š<strong>ç’°ä¿ç½²ç©ºæ°£å“è³ªç›£æ¸¬ç¶²</strong></p>

<p>API ç¯„ä¾‹ï¼ˆJSON æ ¼å¼ï¼‰ï¼š</p>

<p><code>
https://data.moenv.gov.tw/api/v2/aqx_p_432?api_key=ä½ çš„KEY&amp;format=json
</code></p>

<p>ä½ éœ€è¦å…ˆè¨»å†Šå¸³è™Ÿä¸¦å–å¾— API Keyã€‚</p>

<hr />

<h2>2ï¸âƒ£ æ’°å¯«è³‡æ–™æŠ“å–ç¨‹å¼</h2>

<p>åœ¨ <code>pm25_utils.py</code> ä¸­åŠ å…¥ï¼š</p>

<p>```python
import requests</p>

<p>def fetch<em>pm25</em>data(api<em>key):
    url = f"https://data.moenv.gov.tw/api/v2/aqx</em>p<em>432?api</em>key={api<em>key}&amp;format=json"
    response = requests.get(url)
    if response.status</em>code == 200:
        raw = response.json()
        return raw["records"]
    else:
        raise Exception("API éŒ¯èª¤ï¼š" + str(response.status_code))
```</p>

<hr />

<h2>3ï¸âƒ£ æ•´ç†è³‡æ–™æ ¼å¼</h2>

<p>æ–°å¢ä¸€å€‹æ•´ç†è½‰æ›å‡½å¼ï¼š</p>

<p>```python
from datetime import datetime</p>

<p>def transform<em>pm25</em>data(records):
    data<em>list = []
    for r in records:
        try:
            data</em>list.append((
                r["county"],
                r["sitename"],
                float(r["pm2.5"]) if r["pm2.5"] else None,
                datetime.strptime(r["datacreationdate"], "%Y-%m-%d %H:%M"),
                r["unit"]
            ))
        except Exception as e:
            print("è³‡æ–™è½‰æ›éŒ¯èª¤", e)
    return data_list
```</p>

<hr />

<h2>4ï¸âƒ£ å¯«å…¥ MySQL è³‡æ–™åº«</h2>

<p>åœ¨ <code>pm25_utils.py</code> ä¸­å†åŠ å…¥ä»¥ä¸‹å‡½å¼ï¼š</p>

<p>```python
from db<em>utils import open</em>db</p>

<p>def save<em>to</em>mysql(data<em>list):
    conn = open</em>db()
    cur = conn.cursor()</p>

<pre><code>sql = """
INSERT INTO pm25_data (county, site, pm25, datacreationdate, unit)
VALUES (%s, %s, %s, %s, %s)
ON DUPLICATE KEY UPDATE pm25=VALUES(pm25)
"""

cur.executemany(sql, data_list)
conn.commit()
conn.close()
print(f"âœ… å¯«å…¥ {len(data_list)} ç­†è³‡æ–™")
</code></pre>

<p>```</p>

<hr />

<h2>5ï¸âƒ£ å¯¦éš›åŸ·è¡Œæ¸¬è©¦</h2>

<p>æ–°å¢ <code>update_pm25.py</code> æ¸¬è©¦æ•´åˆåŠŸèƒ½ï¼š</p>

<p>```python
from pm25<em>utils import fetch</em>pm25<em>data, transform</em>pm25<em>data, save</em>to_mysql</p>

<p>API_KEY = "è«‹å¡«å…¥ä½ çš„API Key"</p>

<p>records = fetch<em>pm25</em>data(API<em>KEY)
data</em>list = transform<em>pm25</em>data(records)
save<em>to</em>mysql(data_list)
```</p>

<p>åŸ·è¡Œï¼š</p>

<p><code>bash
python update_pm25.py
</code></p>

<p>è‹¥æˆåŠŸå¯«å…¥è³‡æ–™ï¼Œè¡¨ç¤ºæ•´åˆå®Œæˆ âœ…</p>

<hr />

<h2>âœ… æœ¬ç« çµæŸ</h2>

<p>ä½ å·²èƒ½è‡ªå‹•æŠ“å– PM2.5 è³‡æ–™ä¸¦å¯«å…¥ MySQL è³‡æ–™åº«ã€‚<br />
ä¸‹ä¸€ç« æˆ‘å€‘å°‡é–‹å§‹å»ºç«‹å‰ç«¯ç¶²ç«™ï¼Œé¡¯ç¤ºæœ€æ–°è³‡æ–™èˆ‡åœ–è¡¨ï¼</p>

<hr />

<h1>ç¬¬å››ç« ï¼šå»ºç«‹å‰ç«¯ç¶²ç«™èˆ‡åœ–è¡¨å±•ç¤º</h1>

<p>æœ¬ç« å°‡æ•™ä½ å¦‚ä½•ä½¿ç”¨ Flask æ¨¡æ¿æ­é… Chart.js é¡¯ç¤º PM2.5 è³‡æ–™ï¼Œå»ºç«‹äº’å‹•å¼åœ–è¡¨èˆ‡åŸºæœ¬æŸ¥è©¢ä»‹é¢ã€‚</p>

<hr />

<h2>ğŸ¯ æ•™å­¸ç›®æ¨™</h2>

<ul>
<li>ä½¿ç”¨ Flask é¡¯ç¤º HTML ç¶²é </li>
<li>æ•´åˆ Chart.js ç¹ªè£½å³æ™‚ PM2.5 åœ–è¡¨</li>
<li>åŠ å…¥ç«™é»é¸å–®èˆ‡å¾Œç«¯è³‡æ–™æŸ¥è©¢åŠŸèƒ½</li>
</ul>

<hr />

<h2>1ï¸âƒ£ è¨­å®š Flask æ¨¡æ¿è³‡æ–™å¤¾</h2>

<p>Flask é è¨­æœƒå¾ <code>templates/</code> è®€å– HTML æª”æ¡ˆï¼Œè«‹å»ºç«‹ä¸€å€‹ <code>templates/index.html</code>ï¼š</p>

<p>```html
<!DOCTYPE html></p>

<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>PM2.5 å³æ™‚ç›£æ¸¬</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>PM2.5 å³æ™‚ç›£æ¸¬åœ–è¡¨</h2>
  <form method="GET" action="/">
    <label>é¸æ“‡ç«™é»ï¼š
      <select name="site">
        {% for s in site_list %}
          <option value="{{s}}" {% if s == selected_site %}selected{% endif %}>{{s}}</option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">æŸ¥è©¢</button>
  </form>

  <canvas id="pm25Chart" width="600" height="300"></canvas>

  <script>
    const ctx = document.getElementById('pm25Chart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: {{ labels | safe }},
        datasets: [{
          label: 'PM2.5',
          data: {{ values | safe }},
          borderWidth: 2,
          borderColor: 'rgba(75, 192, 192, 1)',
          fill: false
        }]
      },
      options: {
        scales: {
          x: { display: true },
          y: { beginAtZero: true }
        }
      }
    });
  </script>
</body>
</html>

<p>```</p>

<hr />

<h2>2ï¸âƒ£ ä¿®æ”¹ app.py æä¾›è³‡æ–™èˆ‡æ¨¡æ¿</h2>

<p>åœ¨ <code>app.py</code> ä¸­ä¿®æ”¹å¦‚ä¸‹ï¼š</p>

<p>```python
from flask import Flask, render<em>template, request
from db</em>utils import open_db</p>

<p>app = Flask(<strong>name</strong>)</p>

<p>@app.route('/')
def index():
    site = request.args.get("site", default="ä¸­å£¢")</p>

<pre><code>conn = open_db()
cur = conn.cursor()
cur.execute("SELECT DISTINCT site FROM pm25_data ORDER BY site")
site_list = [r[0] for r in cur.fetchall()]

cur.execute("""
    SELECT datacreationdate, pm25
    FROM pm25_data
    WHERE site=%s
    ORDER BY datacreationdate DESC
    LIMIT 20
""", (site,))
rows = cur.fetchall()
conn.close()

labels = [r[0].strftime("%H:%M") for r in rows][::-1]
values = [r[1] for r in rows][::-1]

return render_template("index.html",
                       site_list=site_list,
                       selected_site=site,
                       labels=labels,
                       values=values)
</code></pre>

<p>if <strong>name</strong> == '<strong>main</strong>':
    app.run(debug=True)
```</p>

<hr />

<h2>3ï¸âƒ£ å•Ÿå‹•ç¶²ç«™</h2>

<p>åŸ·è¡Œï¼š</p>

<p><code>bash
python app.py
</code></p>

<p>æ‰“é–‹ç€è¦½å™¨é€²å…¥ <code>http://127.0.0.1:5000/</code>ï¼Œé¸æ“‡ç«™é»å¾Œå³å¯æŸ¥çœ‹ PM2.5 æŠ˜ç·šåœ–ã€‚</p>

<hr />

<h2>âœ… æœ¬ç« çµæŸ</h2>

<p>ä½ å·²å»ºç«‹äº’å‹•å¼åœ–è¡¨ä¸¦èƒ½æŸ¥è©¢æ­·å² PM2.5 è³‡æ–™ï¼Œä¸‹ä¸€ç« å°‡é€²ä¸€æ­¥è¨­è¨ˆè‡ªå‹•æ’ç¨‹èˆ‡ GitHub Actions è‡ªå‹•æ›´æ–°åŠŸèƒ½ã€‚</p>

<hr />

<h1>ç¬¬äº”ç« ï¼šè‡ªå‹•æ’ç¨‹èˆ‡ GitHub Actions è‡ªå‹•æ›´æ–°</h1>

<p>æœ¬ç« å°‡æ•™ä½ å¦‚ä½•é€é GitHub Actions è‡ªå‹•åŸ·è¡Œ PM2.5 è³‡æ–™æ›´æ–°è…³æœ¬ï¼Œå¯¦ç¾æ¯æ—¥å®šæ™‚æŠ“å–èˆ‡å¯«å…¥è³‡æ–™åº«ã€‚</p>

<hr />

<h2>ğŸ¯ æ•™å­¸ç›®æ¨™</h2>

<ul>
<li>å»ºç«‹æ›´æ–°è…³æœ¬ <code>update_pm25.py</code></li>
<li>æ’°å¯« GitHub Actions å·¥ä½œæµç¨‹</li>
<li>è¨­å®šæ¯æ—¥è‡ªå‹•åŸ·è¡Œæ’ç¨‹</li>
</ul>

<hr />

<h2>1ï¸âƒ£ ç¢ºä¿å°ˆæ¡ˆçµæ§‹æ­£ç¢º</h2>

<p>å°ˆæ¡ˆè³‡æ–™å¤¾æ‡‰åŒ…å«ä»¥ä¸‹æª”æ¡ˆçµæ§‹ï¼š</p>

<p><code>
pm25-flask/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ pm25-update.yml
â”œâ”€â”€ update_pm25.py
â”œâ”€â”€ pm25_utils.py
â”œâ”€â”€ db_utils.py
â”œâ”€â”€ requirements.txt
â””â”€â”€ ...
</code></p>

<hr />

<h2>2ï¸âƒ£ å»ºç«‹ GitHub Actions Workflow</h2>

<p>å»ºç«‹ <code>.github/workflows/pm25-update.yml</code> æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼š</p>

<p>```yaml
name: Update PM2.5 DB</p>

<p>on:
  schedule:
    - cron: '30 15 * * *'   # æ¯å¤© 23:30 å°ç£æ™‚é–“ï¼ˆUTC+8ï¼‰
  workflow_dispatch:        # å…è¨±æ‰‹å‹•è§¸ç™¼</p>

<p>jobs:
  update-db:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3</p>

<pre><code>  - name: Set up Python
    uses: actions/setup-python@v4
    with:
      python-version: '3.10'

  - name: Install dependencies
    run: |
      pip install -r requirements.txt

  - name: Run update script
    env:
      API_KEY: ${{ secrets.PM25_API_KEY }}
    run: |
      python update_pm25.py
</code></pre>

<p>```</p>

<hr />

<h2>3ï¸âƒ£ ä¿®æ”¹æ›´æ–°è…³æœ¬æ”¯æ´ç’°å¢ƒè®Šæ•¸</h2>

<p>è«‹å°‡ <code>update_pm25.py</code> æ”¹ç‚ºä»¥ä¸‹æ ¼å¼ï¼š</p>

<p>```python
import os
from pm25<em>utils import fetch</em>pm25<em>data, transform</em>pm25<em>data, save</em>to_mysql</p>

<p>api<em>key = os.environ.get("API</em>KEY")</p>

<p>if not api<em>key:
    raise Exception("æœªæä¾› API</em>KEY ç’°å¢ƒè®Šæ•¸")</p>

<p>records = fetch<em>pm25</em>data(api<em>key)
data</em>list = transform<em>pm25</em>data(records)
save<em>to</em>mysql(data_list)
```</p>

<hr />

<h2>4ï¸âƒ£ è¨­å®š GitHub Secretsï¼ˆæ©Ÿå¯†è³‡æ–™ï¼‰</h2>

<ol>
<li>æ‰“é–‹ä½ çš„ GitHub å°ˆæ¡ˆ</li>
<li>é»é¸ã€ŒSettingsã€â†’ã€ŒSecrets and variablesã€â†’ã€ŒActionsã€</li>
<li>æ–°å¢ä¸€ç­† Secretï¼š
<ul>
<li>Nameï¼š<code>PM25_API_KEY</code></li>
<li>Valueï¼šä½ çš„ API é‡‘é‘°</li>
</ul></li>
</ol>

<p>é€™æ¨£ GitHub å°±å¯ä»¥å®‰å…¨åœ°è®€å–ä½ çš„é‡‘é‘°ä¸¦è‡ªå‹•åŸ·è¡Œæ›´æ–°è…³æœ¬ã€‚</p>

<hr />

<h2>5ï¸âƒ£ æ‰‹å‹•åŸ·è¡Œèˆ‡æ’ç¨‹ç¢ºèª</h2>

<ul>
<li>å¯é€²å…¥ GitHub â†’ Actions â†’ <code>Update PM2.5 DB</code> â†’ æ‰‹å‹•åŸ·è¡Œæ¸¬è©¦</li>
<li>ç¢ºèªæ¯æ—¥æ’ç¨‹æœƒåœ¨ UTC æ™‚é–“ <code>15:30</code>ï¼ˆå°ç£æ™‚é–“ <code>23:30</code>ï¼‰è‡ªå‹•åŸ·è¡Œ</li>
</ul>

<hr />

<h2>âœ… æœ¬ç« çµæŸ</h2>

<p>ä½ å·²æˆåŠŸå°‡ PM2.5 æ›´æ–°è…³æœ¬è‡ªå‹•åŒ–ï¼Œæœªä¾†æ¯å¤©æœƒè‡ªå‹•æ›´æ–°è³‡æ–™ã€‚<br />
æ¥ä¸‹ä¾†ä½ å¯ä»¥è€ƒæ…®éƒ¨ç½²åˆ°ç·šä¸Šï¼ˆRenderã€PythonAnywhereã€Railwayï¼‰è®“åˆ¥äººä¹Ÿèƒ½ç€è¦½åœ–è¡¨ã€‚</p>

<hr />

<h1>ç¬¬å…­ç« ï¼šéƒ¨ç½² Flask PM2.5 å°ˆæ¡ˆåˆ°ç·šä¸Š</h1>

<p>æœ¬ç« å°‡æ•™ä½ å¦‚ä½•å°‡ PM2.5 Flask å°ˆæ¡ˆéƒ¨ç½²åˆ°ç·šä¸Šå¹³å°ï¼Œä¾‹å¦‚ Renderã€PythonAnywhere æˆ– Railwayï¼Œè®“å…¶ä»–äººèƒ½é€éç€è¦½å™¨çœ‹åˆ°ä½ çš„åœ–è¡¨ã€‚</p>

<hr />

<h2>ğŸ¯ æ•™å­¸ç›®æ¨™</h2>

<ul>
<li>äº†è§£éƒ¨ç½²çš„åŸºæœ¬è§€å¿µ</li>
<li>å»ºç«‹ <code>Procfile</code> èˆ‡ <code>requirements.txt</code></li>
<li>ä½¿ç”¨ Render éƒ¨ç½² Flask å°ˆæ¡ˆ</li>
<li>æ³¨æ„éƒ¨ç½²æ™‚çš„ç’°å¢ƒè®Šæ•¸èˆ‡è³‡æ–™åº«é€£ç·šè¨­å®š</li>
</ul>

<hr />

<h2>1ï¸âƒ£ æº–å‚™éƒ¨ç½²æª”æ¡ˆ</h2>

<p>åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„æ–°å¢ä»¥ä¸‹å…©å€‹æª”æ¡ˆï¼š</p>

<h3>ğŸ“„ <code>requirements.txt</code></h3>

<p>å¦‚æœä½ ä¹‹å‰æ²’æœ‰å»ºç«‹éï¼Œè«‹é‡æ–°ç”¢ç”Ÿä¸€æ¬¡ï¼š</p>

<p><code>bash
pip freeze &gt; requirements.txt
</code></p>

<h3>ğŸ“„ <code>Procfile</code></h3>

<p>é€™æ˜¯å‘Šè¨´ Render å¦‚ä½•å•Ÿå‹•ä½ çš„å°ˆæ¡ˆçš„æª”æ¡ˆï¼Œå…§å®¹å¦‚ä¸‹ï¼ˆæ³¨æ„ç„¡å‰¯æª”åï¼‰ï¼š</p>

<p><code>
web: python app.py
</code></p>

<hr />

<h2>2ï¸âƒ£ è¨­å®š <code>app.py</code> å¯è¾¨è­˜åŸ è™Ÿï¼ˆRender éœ€è¦ï¼‰</h2>

<p>ä¿®æ”¹ <code>app.run(...)</code> ç‚ºä»¥ä¸‹æ ¼å¼ï¼š</p>

<p>```python
import os</p>

<p>if <strong>name</strong> == '<strong>main</strong>':
    port = int(os.environ.get("PORT", 5000))
    app.run(host='0.0.0.0', port=port)
```</p>

<hr />

<h2>3ï¸âƒ£ å°‡ç¨‹å¼ç¢¼ä¸Šå‚³ GitHub</h2>

<p>Render ä½¿ç”¨ GitHub å€‰åº«éƒ¨ç½²ï¼Œè«‹å°‡ä½ çš„å°ˆæ¡ˆ Push ä¸Š GitHubï¼š</p>

<p><code>bash
git init
git add .
git commit -m "initial commit"
git remote add origin https://github.com/ä½ çš„å¸³è™Ÿ/pm25-flask.git
git push -u origin master
</code></p>

<hr />

<h2>4ï¸âƒ£ ä½¿ç”¨ Render éƒ¨ç½²æ­¥é©Ÿ</h2>

<ol>
<li>å‰å¾€ <a href="https://render.com/">https://render.com/</a></li>
<li>é»é¸ã€ŒNewã€â†’ã€ŒWeb Serviceã€</li>
<li>é¸æ“‡ GitHub å€‰åº«ä¸¦æˆæ¬Š</li>
<li><p>è¨­å®šå¦‚ä¸‹ï¼š</p>

<p>| é …ç›®            | è¨­å®šå€¼              |
|-----------------|---------------------|
| Environment     | Python              |
| Build Command   | <code>pip install -r requirements.txt</code> |
| Start Command   | <code>python app.py</code>     |
| Branch          | <code>master</code>            |
| Region          | é¸ Taiwan é™„è¿‘å€åŸŸï¼ˆç¾è¥¿æˆ–äºæ´²ï¼‰|</p></li>
<li><p>è‹¥ä½ çš„å°ˆæ¡ˆä¸­ä½¿ç”¨äº† API_KEY æˆ–è³‡æ–™åº«å¸³å¯†ï¼Œå¯åœ¨ã€Œç’°å¢ƒè®Šæ•¸ã€ä¸­è¨­å®šï¼š</p>

<ul>
<li><code>API_KEY=ä½ çš„PM2.5é‡‘é‘°</code></li>
<li><code>DB_HOST</code>ã€<code>DB_USER</code>ã€<code>DB_PASSWORD</code> ç­‰</li>
</ul></li>
</ol>

<hr />

<h2>5ï¸âƒ£ ä½¿ç”¨é›²ç«¯è³‡æ–™åº«ï¼ˆé¸ç”¨ï¼‰</h2>

<p>Render å¯æ•´åˆ PostgreSQLï¼Œå¦‚è¦ç¹¼çºŒä½¿ç”¨æœ¬åœ° MySQLï¼Œå»ºè­°æ”¹ç”¨ Railway + ClearDBã€PlanetScale æˆ–å…¶ä»–æ”¯æ´ MySQL çš„é›²ç«¯å¹³å°ã€‚</p>

<hr />

<h2>âœ… æœ¬ç« çµæŸ</h2>

<p>ä½ å·²å­¸æœƒå°‡å°ˆæ¡ˆéƒ¨ç½²åˆ° Renderï¼Œæœªä¾†ä¹Ÿå¯ä»¥å˜—è©¦éƒ¨ç½²åˆ°å…¶ä»–å¹³å°å¦‚ Railway æˆ– PythonAnywhereï¼Œç”šè‡³æ¥å…¥è‡ªå·±çš„ç¶²åŸŸåç¨±ï¼</p>

<p>ä¸‹ä¸€æ­¥å¯è€ƒæ…®ï¼š
- ç¾åŒ–å‰ç«¯ UI
- å¢åŠ åœ–è¡¨é¡å‹ï¼ˆè¶¨å‹¢åˆ†æã€å€é–“æ¯”è¼ƒï¼‰
- åŠ å…¥ä½¿ç”¨è€…ç™»å…¥ï¼è³‡æ–™ä¸Šå‚³åŠŸèƒ½</p>

<hr />

<h1>ç¬¬ä¸ƒç« ï¼šåŠŸèƒ½æ“´å……èˆ‡é€²éšæ‡‰ç”¨</h1>

<p>æ­å–œä½ å®Œæˆäº† Flask PM2.5 å°ˆæ¡ˆçš„åŸºç¤é–‹ç™¼èˆ‡éƒ¨ç½²ï¼<br />
æœ¬ç« å°‡å¸¶ä½ æ€è€ƒèˆ‡å¯¦ä½œé€²éšåŠŸèƒ½ï¼Œè®“é€™å€‹å°ˆæ¡ˆæ›´å…·äº’å‹•æ€§èˆ‡æ‡‰ç”¨åƒ¹å€¼ã€‚</p>

<hr />

<h2>ğŸ¯ æ•™å­¸ç›®æ¨™</h2>

<ul>
<li>æ€è€ƒå¯¦ç”¨çš„æ“´å……åŠŸèƒ½</li>
<li>åŠ å…¥æ­·å²è³‡æ–™æŸ¥è©¢èˆ‡æ™‚é–“ç¯„åœç¯©é¸</li>
<li>æ”¯æ´å¤šç¨®æ„Ÿæ¸¬æ•¸æ“šï¼ˆPM10ã€O3ã€CO2ï¼‰</li>
<li>å¢åŠ åœ–è¡¨é¡å‹èˆ‡åˆ†æä»‹é¢</li>
</ul>

<hr />

<h2>1ï¸âƒ£ åŠ å…¥æ™‚é–“å€é–“ç¯©é¸åŠŸèƒ½</h2>

<p>åœ¨ <code>app.py</code> ä¸­æ¥æ”¶ <code>start</code> èˆ‡ <code>end</code> GET åƒæ•¸ï¼Œä¿®æ”¹æŸ¥è©¢èªæ³•å¦‚ä¸‹ï¼š</p>

<p>```python
from flask import request
from datetime import datetime</p>

<p>start = request.args.get("start")
end = request.args.get("end")</p>

<p>sql = "SELECT datacreationdate, pm25 FROM pm25_data WHERE site=%s"
params = [site]</p>

<p>if start and end:
    sql += " AND datacreationdate BETWEEN %s AND %s"
    params.extend([start, end])</p>

<p>sql += " ORDER BY datacreationdate DESC LIMIT 100"
cur.execute(sql, tuple(params))
```</p>

<hr />

<h2>2ï¸âƒ£ è¡¨å–®æ–°å¢æ—¥æœŸç¯©é¸æ¬„ä½ï¼ˆHTMLï¼‰</h2>

<p><code>html
&lt;label&gt;èµ·å§‹æ™‚é–“ï¼š&lt;input type="datetime-local" name="start" value="{{start}}"&gt;&lt;/label&gt;
&lt;label&gt;çµæŸæ™‚é–“ï¼š&lt;input type="datetime-local" name="end" value="{{end}}"&gt;&lt;/label&gt;
</code></p>

<p>æ­é… Chart.jsï¼Œè®“ä½¿ç”¨è€…æŸ¥è©¢ç‰¹å®šå€æ®µçš„ PM2.5 è®ŠåŒ–è¶¨å‹¢ã€‚</p>

<hr />

<h2>3ï¸âƒ£ æ”¯æ´æ›´å¤šç’°å¢ƒæ•¸æ“šæ¬„ä½</h2>

<p>ä½ å¯ä»¥ä¿®æ”¹è³‡æ–™è¡¨çµæ§‹ï¼ŒåŠ å…¥ PM10ã€O3ã€CO ç­‰æ¬„ä½ï¼š</p>

<p><code>sql
ALTER TABLE pm25_data ADD pm10 FLOAT, ADD o3 FLOAT, ADD co FLOAT;
</code></p>

<p>ä¸¦åœ¨æŠ“å–èˆ‡å„²å­˜æ™‚åŒæ­¥æ›´æ–°é€™äº›æ¬„ä½ï¼š</p>

<p><code>python
r.get("pm10"), r.get("o3"), r.get("co")
</code></p>

<hr />

<h2>4ï¸âƒ£ å¢åŠ åœ–è¡¨é¡å‹èˆ‡æ¯”è¼ƒæ¨¡å¼</h2>

<ul>
<li>åŠ å…¥ <strong>æ¢ç‹€åœ–</strong> æ¯”è¼ƒä¸åŒç«™é» PM2.5 å¹³å‡å€¼</li>
<li>åŠ å…¥ <strong>é€±æœŸåœ–</strong> å‘ˆç¾ä¸€å¤©å…§çš„é«˜å³°èˆ‡ä½è°·æ™‚é–“</li>
<li>å¯è€ƒæ…®æ­é…å‰ç«¯æ¡†æ¶ï¼ˆå¦‚ Vue.jsï¼‰æˆ–è³‡æ–™è¦–è¦ºåŒ–å·¥å…·ï¼ˆå¦‚ D3.jsï¼‰</li>
</ul>

<hr />

<h2>5ï¸âƒ£ å¯è€ƒæ…®çš„é€²éšåŠŸèƒ½</h2>

<p>| åŠŸèƒ½                 | èªªæ˜ |
|----------------------|------|
| ä½¿ç”¨è€…ç™»å…¥ç³»çµ±       | å»ºç«‹å€‹äººå„€è¡¨æ¿ |
| å°å…¥åœ°åœ–é¡¯ç¤º          | ä½¿ç”¨ Leaflet.js é¡¯ç¤ºåœ°ç†ä½ç½® |
| åŒ¯å‡ºå ±è¡¨             | åŒ¯å‡º Excel æˆ– PDF å ±è¡¨ |
| LINE Notify è­¦ç¤º     | ç©ºæ°£å“è³ªæƒ¡åŒ–æ™‚è‡ªå‹•ç™¼é€æé†’ |
| å¾Œå°è³‡æ–™ç®¡ç†ä»‹é¢     | åˆ©ç”¨ Flask-Admin æä¾›è³‡æ–™æŸ¥çœ‹èˆ‡ä¿®æ”¹åŠŸèƒ½ |</p>

<hr />

<h2>âœ… æœ¬ç« çµæŸ</h2>

<p>ä½ å·²æŒæ¡äº†å°ˆæ¡ˆçš„æ“´å……æ–¹å‘ï¼Œé€™äº›åŠŸèƒ½å¯ä»¥ä¾ç…§å¯¦éš›éœ€æ±‚è‡ªç”±çµ„åˆèˆ‡å¯¦ä½œï¼Œé€²ä¸€æ­¥æ‰“é€ æˆä¸€å€‹å¯¦ç”¨çš„ç’°å¢ƒç›£æ¸¬ç³»çµ±ã€‚</p>

<hr />

<h2>ğŸ“š å»¶ä¼¸å­¸ç¿’å»ºè­°</h2>

<ul>
<li>Flask Blueprint æ¨¡çµ„åŒ–</li>
<li>SQLAlchemy ORM ä½¿ç”¨</li>
<li>Docker å®¹å™¨åŒ–éƒ¨ç½²</li>
<li>å‰å¾Œç«¯åˆ†é›¢ï¼ˆVue / Reactï¼‰</li>
</ul>

<hr />

</body>
</html>
